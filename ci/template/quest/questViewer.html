<!-- extends quest/base_quest.html-->
{% extends "quest/base_quest.html" %}

<!-- override block_head -->
{% block block_head %}
<!-- questViewer.html block_head -->
<!-- css -->
<link type="text/css" rel="stylesheet" href="/static/ci/css/questViewer.css" >
<!-- js -->
<script type="text/javascript" src="/static/ci/js/questViewer.js"></script>
<script type="text/javascript">
    var strQID = "{{ questTarget.strQID }}";
</script>
{% endblock block_head %}

<!-- override block_header -->
{% block block_header %}
<!-- questViewer.html block_header -->
{% endblock block_header %}

<!-- override block_sidebar -->
{% block block_sidebar %}
<!-- questViewer.html block_sidebar -->
{% endblock block_sidebar %}

<!-- override block_footer -->
{% block block_footer %}
<!-- questViewer.html block_footer -->
{% endblock block_footer %}

<!-- override block_content -->
{% block block_content %}
<!-- questViewer.html block_content -->
<!-- 任務狀態 -->
<!-- 任務標題 -->
<div id="divHeadline" class="row">
    {{ questTarget.strHeadline }}
</div>
<!-- 任務標籤 -->
<hr><!-- 水平線 -->
<!-- 任務內容 -->
<div id="divContent" class="row">
    {{ questTarget.strContent }}
</div>
<!-- 剩餘時間 -->
<!-- 任務獎勵 -->
<div id="divReward" class="row">
    獎勵： <span id="strRewardPV">{{ questTarget.intRewardPV }}</span> PV
</div>
<!-- 互動按鈕 -->
<div id="divInteractiveBtn" class="row">
    {% if questTarget.strState == "new" %}
    <!-- 任務狀態 - new -->
        {% if isInitiator %}
        <!-- 發起人 -->
        <button class="btn btn-danger btn-xs" type="button" disabled="true">
            <span class="glyphicon glyphicon-thumbs-up"></span>
            <span class="badge">{{ questTarget.setLikedCIUser.all.count }}</span>
        </button>
        <button id="btnDeleteQuest" class="btn btn-danger btn-xs" type="button">
            刪除任務
        </button>
        {% else %}
        <!-- 除發起人以外的人 -->
            {% if request.user.ciuser in questTarget.setLikedCIUser.all %}
                <button id="btnLikeOrDislikeQuest" class="btn btn-danger btn-xs" type="button" title="取消喜歡">
                    <span class="glyphicon glyphicon-thumbs-up"></span>
                    <span id="strLikedCount" class="badge">{{ questTarget.setLikedCIUser.all.count }}</span>
                </button>
            {% else %}
                <button id="btnLikeOrDislikeQuest" class="btn btn-danger btn-xs" type="button" title="我喜歡">
                    <span class="glyphicon glyphicon-thumbs-up"></span>
                    <span id="strLikedCount" class="badge">{{ questTarget.setLikedCIUser.all.count }}</span>
                </button>
            {% endif %}
        <button id="btnApplyQuest" class="btn btn-danger btn-xs" type="button">
            申請執行任務
        </button>
        {% endif %}
    {% elif questTarget.strState == "matching" %}
    <!-- 任務狀態 - matching -->
        {% if isInitiator %}
        <!-- 發起人 -->
        <button id="btnAcceptApplication" class="btn btn-danger btn-xs" type="button">
            接受申請
        </button>
        <button id="btnRejectApplication" class="btn btn-danger btn-xs" type="button">
            拒絕申請
        </button>
        {% elif isExecutor %}
        <!-- 執行人 -->
        <button id="btnCancelApplication" class="btn btn-danger btn-xs" type="button">
            取消申請
        </button>
        {% else %}
        <!-- 非發起人亦非執行人 -->
        <span>無相關操作</span>
        {% endif %}
    {% elif questTarget.strState == "processing" %}
    <!-- 任務狀態 - processing -->
        {% if isInitiator %}
        <!-- 發起人 -->
        <button id="btnQuestReached" class="btn btn-danger btn-xs" type="button">
            成功達成目標
        </button>
        <button id="btnTerminateQuest" class="btn btn-danger btn-xs" type="button">
            終結任務
        </button>
        {% elif isExecutor %}
        <!-- 執行人 -->
        <button id="btnAbandonQuest" class="btn btn-danger btn-xs" type="button">
            放棄任務
        </button>
        {% else %}
        <!-- 非發起人亦非執行人 -->
        <span>無相關操作</span>
        {% endif %}
    {% elif questTarget.strState == "complete" %}
    <!-- 任務狀態 - complete -->
        {% if isExecutor %}
        <!-- 執行人 -->
        <button id="btnAccomplishQuest" class="btn btn-danger btn-xs" type="button">
            完成任務
        </button>
        {% else %}
        <!-- 除執行人以外的人 -->
        <span>無相關操作</span>
        {% endif %}
    {% elif questTarget.strState == "incomplete" %}
    <!-- 任務狀態 - incomplete -->
        {% if isExecutor %}
        <!-- 執行人 -->
        <button id="btnQuestUnreachable" class="btn btn-danger btn-xs" type="button">
            任務已失敗
        </button>
        {% else %}
        <!-- 除執行人以外的人 -->
        <span>無相關操作</span>
        {% endif %}
    {% elif "ended" in questTarget.strState %}
    <!-- 任務狀態 - ended -->
        <span>無相關操作</span>
    {% else %}
    {% endif %}
</div>
{% endblock block_content %}

<!-- override block_hidden -->
{% block block_hidden %}
<!-- questViewer.html block_hidden -->
{{ block.super }} <!-- 複製上層 template block_hidden 的內容 -->
<!-- 確認申請執行任務 Dialog -->
<div id="dialogConfirmApplyQuest" class="dialogHidden" title="申請執行任務?">
    <p>
        <span class="ui-icon ui-icon-alert"></span>
        <p>等待 發起人 接受申請後再開始執行任務，開始執行後如果：</p>
        <p>任務成功 將獲得 {{ questTarget.intRewardPV }} 點個人 PV</p>
        <p>中途放棄任務 將扣除 {% widthratio questTarget.intRewardPV 2 1 %} 點個人 PV</p>
        <p>確定要 申請執行任務?</p>
    </p>
</div>
<!-- 確認刪除任務 Dialog -->
<div id="dialogConfirmDeleteQuest" class="dialogHidden" title="刪除任務?">
    <p>
        <span class="ui-icon ui-icon-alert"></span>
        確定要刪除任務?
    </p>
</div>
<!-- 確認終結任務 Dialog -->
<div id="dialogConfirmTerminateQuest" class="dialogHidden" title="終結任務?">
    <p>
        <span class="ui-icon ui-icon-alert"></span>
        您將會被扣除 {% widthratio questTarget.intRewardPV 2 1 %} 點個人 PV！確定要終結任務?
    </p>
</div>
<!-- 確認放棄任務 Dialog -->
<div id="dialogConfirmAbandonQuest" class="dialogHidden" title="放棄任務?">
    <p>
        <span class="ui-icon ui-icon-alert"></span>
        您將會被扣除 {% widthratio questTarget.intRewardPV 2 1 %} 點個人 PV！確定要放棄任務?
    </p>
</div>
{% endblock block_hidden %}